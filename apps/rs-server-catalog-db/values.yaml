# Copyright 2024 CS Group
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

app:
  # -- Script's name to be executed after pgstack init, must after `999_initpgstac.sh`
  pgstac_post_actions_script: 999_post_actions.sh
  # -- Script's name to download the STAC extensions schema
  pgstac_init_download_schema_script: download.sh
  stac:
    # -- Additionnals STAC extensions
    extensions:
      - https://stac-extensions.github.io/eo/v1.1.0/schema.json
      - https://stac-extensions.github.io/sat/v1.0.0/schema.json
      - https://stac-extensions.github.io/projection/v1.1.0/schema.json
      - https://stac-extensions.github.io/processing/v1.2.0/schema.json
      - https://stac-extensions.github.io/product/v0.1.0/schema.json
      - https://stac-extensions.github.io/sar/v1.0.0/schema.json
      - https://stac-extensions.github.io/raster/v1.1.0/schema.json
      - https://stac-extensions.github.io/authentication/v1.1.0/schema.json
      - https://stac-extensions.github.io/alternate-assets/v1.2.0/schema.json
      - https://stac-extensions.github.io/timestamps/v1.1.0/schema.json
    # -- Additionnals queryables
    queryables:
      - eo:snow_cover
      - sat:absolute_orbit
      - sat:relative_orbit
      - processing:level
      - processing:facility
      - processing:datetime
      - processing:version
      - product:type
      - product:timeliness
      - product:timeliness_category
      - sar:instrument_mode
      - published
      - expires
      - unpublished

postgres:
  db: {{ rs_server_catalog.database.name }}
  secret:
    user: {{ rs_server_catalog.database.username }}
    pass: {{ rs_server_catalog.database.password }}

# -- Pod affinity
affinity:
  nodeAffinity:
   requiredDuringSchedulingIgnoredDuringExecution:
     nodeSelectorTerms:
     - matchExpressions:
       - key: node-role.kubernetes.io/processing
         operator: Exists

# -- Pod toleration
tolerations:
- key: role
  operator: Equal
  value: processing
  effect: NoSchedule

# -- Pod initContainers
initContainers:
- name: init-pgstac
  image: alpine/curl
  command: [ "/scripts/init/download.sh" ]
  volumeMounts:
    - name: download-json-schema
      mountPath: /scripts/init/
    - name: pgstack-json-schema
      mountPath: /opt/pgstack_json_schema/

volume:
  storageClassName: csi-cinder-high-speed-retain
